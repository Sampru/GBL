<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ALU: src/gutPur.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ALU
   &#160;<span id="projectnumber">5.1</span>
   </div>
   <div id="projectbrief">ALMIS_utilities</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('gut_pur_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">gutPur.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>General purge utilities.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="alu__types_8h_source.html">alu_types.h</a>&gt;</code><br/>
<code>#include &lt;cardinal.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="chaine_8h_source.html">chaine.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cst__def_8h_source.html">cst_def.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="dyn_def_8h_source.html">dynDef.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="err_def_8h_source.html">errDef.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="gb_8h_source.html">gb.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="gut__def_8h_source.html">gut_def.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="memoire_8h_source.html">memoire.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sfi_def_8h_source.html">sfiDef.h</a>&gt;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acceb2258ba0e17daf9c93a5a276be103"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#acceb2258ba0e17daf9c93a5a276be103">lcGUTpurGetLdDat</a> (void *Ctx, int Pdays, char *DbTab, char *DatFld, char *Dat, char *Where, void **LdDat)</td></tr>
<tr class="memdesc:acceb2258ba0e17daf9c93a5a276be103"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the list of dates to keep in a purge process.  <a href="#acceb2258ba0e17daf9c93a5a276be103"></a><br/></td></tr>
<tr class="separator:acceb2258ba0e17daf9c93a5a276be103"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af311cb2ea11638d20ce660b641e708e4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#af311cb2ea11638d20ce660b641e708e4">GUTpurTab</a> (void *Ctx, char **LstTab, int NbTab)</td></tr>
<tr class="memdesc:af311cb2ea11638d20ce660b641e708e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Purge table contains.  <a href="#af311cb2ea11638d20ce660b641e708e4"></a><br/></td></tr>
<tr class="separator:af311cb2ea11638d20ce660b641e708e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81829a0d6b21ccedeee263f2394a1dfe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#a81829a0d6b21ccedeee263f2394a1dfe">GUTpurTabNbDay</a> (void *Ctx, <a class="el" href="structgut_pur_tab.html">gutPurTab</a> *LstTab, int NbTab, char *Dat, int Mod)</td></tr>
<tr class="memdesc:a81829a0d6b21ccedeee263f2394a1dfe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Purge table contains before nb days.  <a href="#a81829a0d6b21ccedeee263f2394a1dfe"></a><br/></td></tr>
<tr class="separator:a81829a0d6b21ccedeee263f2394a1dfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af245b9935ebda7d95f8c9cdf96da4f6a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#af245b9935ebda7d95f8c9cdf96da4f6a">GUTpurTabKepMthYea</a> (void *Ctx, <a class="el" href="structgut_pur_tab.html">gutPurTab</a> *LstTab, int NbTab, char *Dat, int Mod)</td></tr>
<tr class="memdesc:af245b9935ebda7d95f8c9cdf96da4f6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Purge table contents maintaining PurNbDays, end of months of 'n' years and end of previous years.  <a href="#af245b9935ebda7d95f8c9cdf96da4f6a"></a><br/></td></tr>
<tr class="separator:af245b9935ebda7d95f8c9cdf96da4f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee2ce9b208351bd2690f23a0d7b66812"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#aee2ce9b208351bd2690f23a0d7b66812">GUTpurHisTab</a> (void *Ctx, char *Dat, char *CstPur, void *LdNht)</td></tr>
<tr class="memdesc:aee2ce9b208351bd2690f23a0d7b66812"><td class="mdescLeft">&#160;</td><td class="mdescRight">Purge of the historisation tables.  <a href="#aee2ce9b208351bd2690f23a0d7b66812"></a><br/></td></tr>
<tr class="separator:aee2ce9b208351bd2690f23a0d7b66812"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a363f6bde6569a9a92a8f35c0f5cc48"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#a8a363f6bde6569a9a92a8f35c0f5cc48">GUTpurGetTab</a> (void *Ctx, char *Tab, void **LdTab)</td></tr>
<tr class="memdesc:a8a363f6bde6569a9a92a8f35c0f5cc48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a list with the tables that can be purged.  <a href="#a8a363f6bde6569a9a92a8f35c0f5cc48"></a><br/></td></tr>
<tr class="separator:a8a363f6bde6569a9a92a8f35c0f5cc48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae166fcd83a6caf49f39c9e2abdd1cecb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#ae166fcd83a6caf49f39c9e2abdd1cecb">GUTpurSpePur</a> (void *Ctx, char *Dat)</td></tr>
<tr class="memdesc:ae166fcd83a6caf49f39c9e2abdd1cecb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Launches the defined specific purges.  <a href="#ae166fcd83a6caf49f39c9e2abdd1cecb"></a><br/></td></tr>
<tr class="separator:ae166fcd83a6caf49f39c9e2abdd1cecb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95e346d67a5c347bd669515a95d72b5d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gut_pur_8c.html#a95e346d67a5c347bd669515a95d72b5d">GUTpurGetWheSpe</a> (void *LdPur, char **Whe)</td></tr>
<tr class="memdesc:a95e346d67a5c347bd669515a95d72b5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the where clause to add to the purging sentence.  <a href="#a95e346d67a5c347bd669515a95d72b5d"></a><br/></td></tr>
<tr class="separator:a95e346d67a5c347bd669515a95d72b5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>General purge utilities. </p>
<p>General utilities to purge data</p>
<dl class="section user"><dt>Acronyme</dt><dd>GUTpur</dd></dl>
<dl class="section user"><dt>Library</dt><dd>gut</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Edurne GORDOA - 01/Oct/2002 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a8a363f6bde6569a9a92a8f35c0f5cc48"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GUTpurGetTab </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Tab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>LdTab</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a list with the tables that can be purged. </p>
<p>Get a list with the tables that can be purged</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctx</td><td>Database context </td></tr>
    <tr><td class="paramname">Tab</td><td>String used as a table filter in a LIKE clause. If nothing, pass NULL. </td></tr>
    <tr><td class="paramname">LdTab</td><td>List with the tables that can be purged. They should be in the first column of the list. If nothing, NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jon BARRUTIA - 24/Oct/2008 </dd></dl>

</div>
</div>
<a class="anchor" id="a95e346d67a5c347bd669515a95d72b5d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GUTpurGetWheSpe </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>LdPur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>Whe</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the where clause to add to the purging sentence. </p>
<p>Returns the where clause to add to the purging sentence with the specified criteria. It constructs a where clause like " AND Col = 'Val' AND Col2 = 'Val2'"</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">LdPur</td><td>List with the criteria for the definition of purges. It will have two columns: Col, Val (column name and value). </td></tr>
    <tr><td class="paramname">Whe</td><td>Current date</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jon BARRUTIA - 24/Oct/2008 </dd></dl>

</div>
</div>
<a class="anchor" id="aee2ce9b208351bd2690f23a0d7b66812"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GUTpurHisTab </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Dat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>CstPur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>LdNht</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Purge of the historisation tables. </p>
<p>Purge of the historisation tables. The tables that are purged are those that their name begin by HIS and are not in the LdNht list passed as an argument.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctx</td><td>Database context </td></tr>
    <tr><td class="paramname">Dat</td><td>Current date (reference for purge) </td></tr>
    <tr><td class="paramname">CstPur</td><td>Identifier of the cst that have the number of days to preserve the data </td></tr>
    <tr><td class="paramname">LdNht</td><td>List with the HIS tables that are not purged. They should be in the first column of the list. If nothing, NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jon BARRUTIA - 27/Sep/2004</dd></dl>
<dl class="section user"><dt>Modified</dt><dd></dd></dl>
<ul>
<li>Alex RODRIGUEZ - 13/Oct/2004. Carried from FIT purge.c file. Also I've renamed it to lcGUTpurHisTab &ndash;&gt; GUTpurHisTab.</li>
<li>Iker ZURIARRAIN - 05/Oct/2005. Don't take objects starting with HIS that are not tables</li>
<li>Josune BIKUNA - 15/Feb/2007: Substitute the field 'CrtFld' with 'Whe' in the <a class="el" href="structgut_pur_tab.html">gutPurTab</a> structure, this is, give the possibility to add a complete where clause for the purging sentence of each table, instead of using only a value for a criterion. </li>
</ul>

</div>
</div>
<a class="anchor" id="ae166fcd83a6caf49f39c9e2abdd1cecb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GUTpurSpePur </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Dat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Launches the defined specific purges. </p>
<p>Launches the defined specific purges with the defined purging function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctx</td><td>Database context </td></tr>
    <tr><td class="paramname">Dat</td><td>Current date</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Jon BARRUTIA - 24/Oct/2008</dd></dl>
<dl class="section user"><dt>Modified</dt><dd></dd></dl>
<ul>
<li>Jon BARRUTIA - 03/Nov/2008: Go to the end if no purges defined </li>
</ul>

</div>
</div>
<a class="anchor" id="af311cb2ea11638d20ce660b641e708e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GUTpurTab </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>LstTab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>NbTab</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Purge table contains. </p>
<p>Purges table contains</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctx</td><td>Database context </td></tr>
    <tr><td class="paramname">LstTab</td><td>Array with the name of tables to purge </td></tr>
    <tr><td class="paramname">NbTab</td><td>Number of tables to purge</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Edurne GORDOA - 01/Oct/2002 </dd></dl>

</div>
</div>
<a class="anchor" id="af245b9935ebda7d95f8c9cdf96da4f6a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GUTpurTabKepMthYea </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgut_pur_tab.html">gutPurTab</a> *&#160;</td>
          <td class="paramname"><em>LstTab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>NbTab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Dat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Mod</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Purge table contents maintaining PurNbDays, end of months of 'n' years and end of previous years. </p>
<p>Purge table contents maintaining PurNbDays, end of months of 'n' years and end of previous years</p>
<ul>
<li>PurNbDays is taken from AO defined in LstTab [CntTab].IdeCst</li>
<li>The 'pas' value of 'PurLimYear' constant will indicate the date when the end of months of previous years must be purged.</li>
<li>The 'val' value of 'PurLimYear' constant will indicate the number of years the end of months of previous years must be kept when the limit date ('pas' value of 'PurLimYear') arrives. This is the way to it works when the limit date arrives:<ul>
<li>If this 'val' value is 0, deletes all the end of months of previous years</li>
<li>If this 'val' value is 1, keeps the end of month of current and previous year and removes the other ones, except for the end of years dates.</li>
<li>...</li>
</ul>
</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctx</td><td>Database context </td></tr>
    <tr><td class="paramname">LstTab</td><td>Table definition to purge </td></tr>
    <tr><td class="paramname">NbTab</td><td>Number of tables </td></tr>
    <tr><td class="paramname">Dat</td><td>Reference date </td></tr>
    <tr><td class="paramname">Mod</td><td>Filter, what to purge</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Edurne GORDOA - 01/Oct/2002</dd></dl>
<dl class="section user"><dt>Modified</dt><dd></dd></dl>
<ul>
<li>Josune BIKUNA - 15/Feb/2007: Substitute the field 'CrtFld' with 'Whe' in the <a class="el" href="structgut_pur_tab.html">gutPurTab</a> structure, this is, give the possibility to add a complete where clause for the purging sentence of each table, instead of using only a value for a criterion. Remove WheCrt parameter because it was the value for the mentioned criterion.</li>
<li>Alex RODRIGUEZ - 29/Dec/2011: Move Dat Pdays before to avoid memory problems when there are a lot of dates</li>
<li>Edurne GORDOA - 10/Oct/2012: Modifications to avoid doxygen warnings </li>
</ul>

</div>
</div>
<a class="anchor" id="a81829a0d6b21ccedeee263f2394a1dfe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GUTpurTabNbDay </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgut_pur_tab.html">gutPurTab</a> *&#160;</td>
          <td class="paramname"><em>LstTab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>NbTab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Dat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Mod</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Purge table contains before nb days. </p>
<p>Purges table's data before a number of days. The tables to be purged and their comes in a structure. If the number of days to purge is -1 then doesn't purge</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctx</td><td>Database context </td></tr>
    <tr><td class="paramname">LstTab</td><td>Table definition to purge </td></tr>
    <tr><td class="paramname">NbTab</td><td>Number of elements in LstTab </td></tr>
    <tr><td class="paramname">Dat</td><td>Reference date </td></tr>
    <tr><td class="paramname">Mod</td><td>Filter, what to purge</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Edurne GORDOA - 01/Oct/2002</dd></dl>
<dl class="section user"><dt>Modified</dt><dd></dd></dl>
<ul>
<li>Nerea RAMOS - 13/Sep/2004. Changed decal_jdate -&gt; clMovDateDay</li>
<li>Josune BIKUNA - 15/Feb/2007: Substitute the field 'CrtFld' with 'Whe' in the <a class="el" href="structgut_pur_tab.html">gutPurTab</a> structure, this is, give the possibility to add a complete where clause for the purging sentence of each table, instead of using only a value for a criterion. Remove WheCrt parameter because it was the value for the mentioned criterion.</li>
<li>Jesus Maria GARCIA - 30/Apr/2010: If the number of days to purge is -1 then doesn't purge </li>
</ul>

</div>
</div>
<a class="anchor" id="acceb2258ba0e17daf9c93a5a276be103"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int lcGUTpurGetLdDat </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Pdays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>DbTab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>DatFld</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Dat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Where</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>LdDat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the list of dates to keep in a purge process. </p>
<p>Get the list of dates to keep in a purge process</p>
<ul>
<li>Get the list of all dates in table previous to reference date and remove those that are not in the "Pdays" last dates and are not last dates of month of 'n' previous years or last dates of previous years. The 'pas' value of 'PurLimYear' constant will indicate the date when the end of months of previous years must be purged. The 'val' value of 'PurLimYear' constant will indicate the number of years the end of months of previous years must be kept when the limit date ('pas' value of 'PurLimYear') arrives. This is the way to it works when the limit date arrives:</li>
<li>- If this 'val' value is 0, deletes all the end of months of previous years</li>
<li>- If this 'val' value is 1, keeps the end of month of current and previous year and removes the other ones, except for the end of years dates.</li>
<li>- ...</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Ctx</td><td>Database context </td></tr>
    <tr><td class="paramname">Pdays</td><td>Number of last dates to keep </td></tr>
    <tr><td class="paramname">DbTab</td><td>Database table name </td></tr>
    <tr><td class="paramname">DatFld</td><td>Table field that contains the date </td></tr>
    <tr><td class="paramname">Dat</td><td>Reference date </td></tr>
    <tr><td class="paramname">Where</td><td>Where clause (might be null) </td></tr>
    <tr><td class="paramname">LdDat</td><td>(out) list of dates to keep</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error code (0: OK)</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Basilio TAMAYO - 16/Oct/2000</dd></dl>
<dl class="section user"><dt>Modified</dt><dd></dd></dl>
<ul>
<li>Edurne GORDOA - 01/Oct/2002. Carried from base_functions.c</li>
<li>Josune BIKUNA - 27/Feb/2006. From now on, the 'val' value of 'PurLimYear' constant, will indicate the number of years the end of months of previous years must be kept when the limit date of 'pas' value arrives. Until now, all the end of months of previous years were removed when the limit date arrived.</li>
<li>Alex RODRIGUEZ - 29/Dec/2011: Move Dat Pdays before to avoid memory problems when there are a lot of dates</li>
<li>Alex RODRIGUEZ - 30/Dec/2011: Correct compilation errors.</li>
<li>Gotzon ETXEBERRIA &amp; Ruben GIL - 15/Oct/2012: Fixed bug in the number of days to take end of month and year</li>
<li>Gotzon ETXEBERRIA &amp; Ruben GIL - 13/Nov/2012: When take previous date, use dat parameter instead of the last of the list </li>
</ul>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="gut_pur_8c.html">gutPur.c</a></li>
    <li class="footer">Copyright &#169 ALMIS Informatica Financiera S.L. Reserved all the rights. Generated on Wed Jul 4 2018 22:30:35 for ALU by 
    <a href="http://www.almis.com">
    <img class="footer" src="DxyAlm.png" alt="ALMIS"/></a> </li>
  </ul>
</div>
</body>
</html>
